# ═══════════════════════════════════════════════════════════════════════════════
# TRIPLE-HYBRID-RAG CONFIGURATION
# The Ultimate RAG System: Lexical + Semantic + Graph with Multimodal Support
# ═══════════════════════════════════════════════════════════════════════════════

# ───────────────────────────────────────────────────────────────────────────────
# DATABASE (PostgreSQL + pgvector)
# ───────────────────────────────────────────────────────────────────────────────
DATABASE_URL=postgresql://postgres:postgres@localhost:54332/rag_db
DATABASE_POOL_SIZE=10
DATABASE_MAX_OVERFLOW=20

# ───────────────────────────────────────────────────────────────────────────────
# OPENAI API (LLM for query planning, entity extraction)
# ───────────────────────────────────────────────────────────────────────────────
OPENAI_API_KEY=sk-your-openai-api-key
OPENAI_BASE_URL=https://api.openai.com/v1
OPENAI_MODEL=gpt-5

# ───────────────────────────────────────────────────────────────────────────────
# EMBEDDING API (Qwen3-VL-Embedding-2B via local inference server)
# ───────────────────────────────────────────────────────────────────────────────
RAG_EMBED_API_BASE=http://127.0.0.1:1234/v1
RAG_EMBED_MODEL=qwen3-vl-embedding-2b
RAG_EMBED_BATCH_SIZE=20
RAG_EMBED_TIMEOUT=60.0

# Matryoshka Embeddings (2048d model → 1024d storage)
RAG_EMBED_DIM_MODEL=2048
RAG_EMBED_DIM_STORE=1024

# ───────────────────────────────────────────────────────────────────────────────
# RERANKING API (Qwen3-VL-Reranker-2B via local inference server)
# ───────────────────────────────────────────────────────────────────────────────
RAG_RERANK_API_BASE=http://127.0.0.1:1234/v1
RAG_RERANK_MODEL=qwen3-vl-reranker-2b
RAG_RERANK_TIMEOUT=30.0

# ───────────────────────────────────────────────────────────────────────────────
# OCR API (Qwen3-VL for vision, optional DeepSeek-OCR)
# ───────────────────────────────────────────────────────────────────────────────
RAG_OCR_API_BASE=http://127.0.0.1:1234/v1
RAG_OCR_MODEL=qwen3-vl-8b
RAG_OCR_TIMEOUT=60.0

# Optional: DeepSeek-OCR endpoint (toggle with RAG_DEEPSEEK_OCR_ENABLED)
RAG_DEEPSEEK_OCR_API_BASE=http://127.0.0.1:8000/v1
RAG_DEEPSEEK_OCR_MODEL=deepseek-ocr

# ───────────────────────────────────────────────────────────────────────────────
# PUPPYGRAPH (Knowledge Graph via Bolt/Cypher)
# ───────────────────────────────────────────────────────────────────────────────
PUPPYGRAPH_BOLT_URL=bolt://localhost:7697
PUPPYGRAPH_HTTP_URL=http://localhost:8192
PUPPYGRAPH_WEB_UI_URL=http://localhost:8091
PUPPYGRAPH_USERNAME=admin
PUPPYGRAPH_PASSWORD=puppygraph123
PUPPYGRAPH_TIMEOUT=30.0

# ═══════════════════════════════════════════════════════════════════════════════
# FEATURE FLAGS (All Toggleable)
# ═══════════════════════════════════════════════════════════════════════════════

# ───────────────────────────────────────────────────────────────────────────────
# Master Switches
# ───────────────────────────────────────────────────────────────────────────────
RAG_ENABLED=true                          # Master enable/disable

# ───────────────────────────────────────────────────────────────────────────────
# Retrieval Channels (All Toggleable)
# ───────────────────────────────────────────────────────────────────────────────
RAG_LEXICAL_ENABLED=true                  # BM25/FTS search
RAG_SEMANTIC_ENABLED=true                 # Vector search (HNSW)
RAG_GRAPH_ENABLED=true                    # Knowledge Graph (PuppyGraph Cypher)

# ───────────────────────────────────────────────────────────────────────────────
# Processing Features
# ───────────────────────────────────────────────────────────────────────────────
RAG_RERANK_ENABLED=true                   # Reranking with Qwen3-VL-Reranker-2B
RAG_DENOISE_ENABLED=true                  # Conformal denoising
RAG_QUERY_PLANNER_ENABLED=true            # GPT-5 query decomposition

# ───────────────────────────────────────────────────────────────────────────────
# Ingestion Features
# ───────────────────────────────────────────────────────────────────────────────
RAG_ENTITY_EXTRACTION_ENABLED=true        # GPT-5 NER/RE during ingestion
RAG_OCR_ENABLED=true                      # OCR for images/scanned docs
RAG_DEEPSEEK_OCR_ENABLED=false            # Use DeepSeek-OCR (else Qwen3-VL)
RAG_MULTIMODAL_EMBEDDING_ENABLED=true     # Direct image embeddings

# ───────────────────────────────────────────────────────────────────────────────
# Chunking Features
# ───────────────────────────────────────────────────────────────────────────────
RAG_PARENT_CHILD_CHUNKING=true            # Hierarchical chunking
RAG_MATRYOSHKA_EMBEDDINGS=true            # Truncated embeddings (2048→1024)

# ═══════════════════════════════════════════════════════════════════════════════
# CHUNKING CONFIGURATION
# ═══════════════════════════════════════════════════════════════════════════════

# Parent Chunks (context units)
RAG_PARENT_CHUNK_TOKENS=800               # Target parent chunk size (tokens)
RAG_PARENT_CHUNK_MAX_TOKENS=1000          # Max parent chunk size (won't exceed)

# Child Chunks (retrieval units)
RAG_CHILD_CHUNK_TOKENS=200                # Target child chunk size (tokens)
RAG_CHUNK_OVERLAP_TOKENS=50               # Overlap between chunks

# ═══════════════════════════════════════════════════════════════════════════════
# RETRIEVAL CONFIGURATION
# ═══════════════════════════════════════════════════════════════════════════════

# ───────────────────────────────────────────────────────────────────────────────
# Weights (RRF Fusion)
# ───────────────────────────────────────────────────────────────────────────────
RAG_LEXICAL_WEIGHT=0.7                    # Lexical (FTS) weight in RRF
RAG_SEMANTIC_WEIGHT=0.8                   # Semantic (vector) weight in RRF
RAG_GRAPH_WEIGHT=1.0                      # Graph weight in RRF

# ───────────────────────────────────────────────────────────────────────────────
# Safety & Denoising
# ───────────────────────────────────────────────────────────────────────────────
RAG_SAFETY_THRESHOLD=0.6                  # Min similarity threshold
RAG_DENOISE_ALPHA=0.6                     # Conformal denoising alpha

# ───────────────────────────────────────────────────────────────────────────────
# Top-K Settings per Stage
# ───────────────────────────────────────────────────────────────────────────────
RAG_LEXICAL_TOP_K=50                      # Max results from FTS
RAG_SEMANTIC_TOP_K=100                    # Max results from vector search
RAG_GRAPH_TOP_K=50                        # Max results from graph search
RAG_RERANK_TOP_K=20                       # Results to rerank
RAG_FINAL_TOP_K=5                         # Final results after rerank

# ═══════════════════════════════════════════════════════════════════════════════
# QUERY PLANNER CONFIGURATION
# ═══════════════════════════════════════════════════════════════════════════════
RAG_QUERY_PLANNER_MODEL=gpt-5             # Model for query planning
RAG_QUERY_PLANNER_TEMPERATURE=0.0         # Temperature (0=deterministic)

# ═══════════════════════════════════════════════════════════════════════════════
# ENTITY EXTRACTION CONFIGURATION
# ═══════════════════════════════════════════════════════════════════════════════
RAG_NER_MODEL=gpt-5                       # Model for entity extraction
RAG_NER_TEMPERATURE=0.0                   # Temperature for NER

# Entity types to extract (comma-separated)
# Available: PERSON, ORGANIZATION, PRODUCT, CLAUSE, DATE, MONEY, PERCENTAGE, 
#            LOCATION, TECHNICAL_TERM, REGULATION, EVENT, CONCEPT
RAG_ENTITY_TYPES=PERSON,ORGANIZATION,PRODUCT,CLAUSE,DATE,MONEY,LOCATION,TECHNICAL_TERM

# ═══════════════════════════════════════════════════════════════════════════════
# GUNDAM TILING OCR CONFIGURATION
# ═══════════════════════════════════════════════════════════════════════════════
RAG_GUNDAM_TILING_ENABLED=true            # Enable Gundam Tiling for large images
RAG_GUNDAM_MIN_IMAGE_SIZE=1500            # Min dimension (px) to trigger tiling
RAG_GUNDAM_TILE_SIZE=1024                 # Tile size (px)
RAG_GUNDAM_OVERLAP=128                    # Overlap between tiles (px)
RAG_GUNDAM_MAX_TILES=16                   # Max tiles per image
RAG_GUNDAM_MERGE_STRATEGY=fuzzy           # Merge strategy: fuzzy, concat, vote
RAG_GUNDAM_FUZZY_THRESHOLD=0.85           # Similarity threshold for fuzzy merge

# ═══════════════════════════════════════════════════════════════════════════════
# OBSERVABILITY (Optional)
# ═══════════════════════════════════════════════════════════════════════════════
RAG_METRICS_ENABLED=false                 # Enable Prometheus metrics
RAG_METRICS_PORT=9190                     # Metrics endpoint port

# ═══════════════════════════════════════════════════════════════════════════════
# LOGGING
# ═══════════════════════════════════════════════════════════════════════════════
LOG_LEVEL=INFO                            # DEBUG, INFO, WARNING, ERROR
LOG_FORMAT=json                           # json or text
