# ═══════════════════════════════════════════════════════════════════════════════
# Triple-Hybrid-RAG Configuration
# Copy this file to .env and customize for your environment
# ═══════════════════════════════════════════════════════════════════════════════

# ───────────────────────────────────────────────────────────────────────────────
# DATABASE
# ───────────────────────────────────────────────────────────────────────────────
# PostgreSQL connection URL (with pgvector extension)
DATABASE_URL=postgresql://postgres:postgres@localhost:54332/rag_db
DATABASE_POOL_SIZE=10
DATABASE_MAX_OVERFLOW=20

# ───────────────────────────────────────────────────────────────────────────────
# OPENAI API (for query planner, entity extraction, etc.)
# ───────────────────────────────────────────────────────────────────────────────
OPENAI_API_KEY=sk-your-api-key-here
OPENAI_BASE_URL=https://api.openai.com/v1
OPENAI_MODEL=gpt-4

# ───────────────────────────────────────────────────────────────────────────────
# EMBEDDING API
# Uses OpenAI-compatible API (vLLM, Ollama, LM Studio, etc.)
# ───────────────────────────────────────────────────────────────────────────────
RAG_EMBED_API_BASE=http://127.0.0.1:1234/v1
RAG_EMBED_MODEL=qwen3-vl-embedding-2b
RAG_EMBED_BATCH_SIZE=200
RAG_EMBED_CONCURRENT_BATCHES=8
RAG_EMBED_TIMEOUT=60.0

# Embedding dimensions (Matryoshka)
RAG_EMBED_DIM_MODEL=2048
RAG_EMBED_DIM_STORE=1024

# ───────────────────────────────────────────────────────────────────────────────
# RERANKING API
# ───────────────────────────────────────────────────────────────────────────────
RAG_RERANK_API_BASE=http://127.0.0.1:1234/v1
RAG_RERANK_MODEL=qwen3-vl-reranker-2b
RAG_RERANK_TIMEOUT=30.0

# ───────────────────────────────────────────────────────────────────────────────
# OCR API (Vision Language Model)
# ───────────────────────────────────────────────────────────────────────────────
RAG_OCR_API_BASE=http://127.0.0.1:1234/v1
RAG_OCR_MODEL=qwen3-vl-8b
RAG_OCR_TIMEOUT=60.0

# DeepSeek OCR (alternative)
RAG_DEEPSEEK_OCR_API_BASE=http://127.0.0.1:8000/v1
RAG_DEEPSEEK_OCR_MODEL=deepseek-ocr

# ───────────────────────────────────────────────────────────────────────────────
# PUPPYGRAPH (Graph Database)
# ───────────────────────────────────────────────────────────────────────────────
PUPPYGRAPH_BOLT_URL=bolt://localhost:7697
PUPPYGRAPH_HTTP_URL=http://localhost:8192
PUPPYGRAPH_WEB_UI_URL=http://localhost:8091
PUPPYGRAPH_USERNAME=admin
PUPPYGRAPH_PASSWORD=puppygraph123
PUPPYGRAPH_TIMEOUT=30.0

# ───────────────────────────────────────────────────────────────────────────────
# FEATURE FLAGS
# ───────────────────────────────────────────────────────────────────────────────
# Master switch
RAG_ENABLED=true

# Retrieval channels
RAG_LEXICAL_ENABLED=true
RAG_SEMANTIC_ENABLED=true
RAG_GRAPH_ENABLED=true

# Processing features
RAG_RERANK_ENABLED=true
RAG_DENOISE_ENABLED=true
RAG_QUERY_PLANNER_ENABLED=true

# Ingestion features
RAG_ENTITY_EXTRACTION_ENABLED=true
RAG_OCR_ENABLED=true
RAG_DEEPSEEK_OCR_ENABLED=false
RAG_MULTIMODAL_EMBEDDING_ENABLED=true

# ───────────────────────────────────────────────────────────────────────────────
# INGESTION SETTINGS
# ───────────────────────────────────────────────────────────────────────────────
# Retry settings for transient failures
RAG_INGEST_EMBED_RETRY_ATTEMPTS=3
RAG_INGEST_DB_RETRY_ATTEMPTS=3
RAG_INGEST_RETRY_BACKOFF_MIN=1.0
RAG_INGEST_RETRY_BACKOFF_MAX=10.0

# Database batch insert size (reduces network round-trips)
RAG_DB_BATCH_SIZE=1000

# ───────────────────────────────────────────────────────────────────────────────
# EMBEDDING CACHE
# Caches embeddings to avoid re-embedding identical content
# ───────────────────────────────────────────────────────────────────────────────
RAG_EMBEDDING_CACHE_ENABLED=true

# Backend: 'memory' (in-process LRU) or 'redis' (distributed)
RAG_EMBEDDING_CACHE_BACKEND=memory

# Memory backend settings
RAG_EMBEDDING_CACHE_MAX_SIZE=100000

# Redis backend settings
RAG_EMBEDDING_CACHE_TTL=604800
RAG_EMBEDDING_CACHE_REDIS_URL=redis://localhost:6379

# ───────────────────────────────────────────────────────────────────────────────
# PIPELINED INGESTION
# Overlaps chunking and embedding for faster processing
# ───────────────────────────────────────────────────────────────────────────────
RAG_PIPELINE_ENABLED=true
RAG_PIPELINE_QUEUE_SIZE=10

# ───────────────────────────────────────────────────────────────────────────────
# CHUNKING CONFIGURATION
# ───────────────────────────────────────────────────────────────────────────────
RAG_PARENT_CHILD_CHUNKING=true
RAG_MATRYOSHKA_EMBEDDINGS=true

# Chunk sizes in tokens
RAG_PARENT_CHUNK_TOKENS=800
RAG_PARENT_CHUNK_MAX_TOKENS=1000
RAG_CHILD_CHUNK_TOKENS=200
RAG_CHUNK_OVERLAP_TOKENS=50

# ───────────────────────────────────────────────────────────────────────────────
# RETRIEVAL CONFIGURATION
# ───────────────────────────────────────────────────────────────────────────────
# RRF weights for each channel
RAG_LEXICAL_WEIGHT=0.7
RAG_SEMANTIC_WEIGHT=0.8
RAG_GRAPH_WEIGHT=1.0

# Safety & Denoising
RAG_SAFETY_THRESHOLD=0.6
RAG_DENOISE_ALPHA=0.6

# Top-K settings for each stage
RAG_LEXICAL_TOP_K=50
RAG_SEMANTIC_TOP_K=100
RAG_GRAPH_TOP_K=50
RAG_RERANK_TOP_K=20
RAG_FINAL_TOP_K=5

# ───────────────────────────────────────────────────────────────────────────────
# QUERY PLANNER
# ───────────────────────────────────────────────────────────────────────────────
RAG_QUERY_PLANNER_MODEL=gpt-4
RAG_QUERY_PLANNER_TEMPERATURE=0.0

# ───────────────────────────────────────────────────────────────────────────────
# ENTITY EXTRACTION
# ───────────────────────────────────────────────────────────────────────────────
RAG_NER_MODEL=gpt-4
RAG_NER_TEMPERATURE=0.0
RAG_NER_MAX_CHUNKS_PER_REQUEST=8
RAG_NER_MAX_CHARS_PER_CHUNK=2000
RAG_ENTITY_TYPES=PERSON,ORGANIZATION,PRODUCT,CLAUSE,DATE,MONEY,LOCATION,TECHNICAL_TERM

# ───────────────────────────────────────────────────────────────────────────────
# GUNDAM TILING OCR
# Splits large images into tiles for better OCR accuracy
# ───────────────────────────────────────────────────────────────────────────────
RAG_GUNDAM_TILING_ENABLED=true
RAG_GUNDAM_MIN_IMAGE_SIZE=1500
RAG_GUNDAM_TILE_SIZE=1024
RAG_GUNDAM_OVERLAP=128
RAG_GUNDAM_MAX_TILES=16
RAG_GUNDAM_MERGE_STRATEGY=fuzzy
RAG_GUNDAM_FUZZY_THRESHOLD=0.85

# ───────────────────────────────────────────────────────────────────────────────
# OBSERVABILITY
# ───────────────────────────────────────────────────────────────────────────────
RAG_METRICS_ENABLED=false
RAG_METRICS_PORT=9190

# ───────────────────────────────────────────────────────────────────────────────
# LOGGING
# ───────────────────────────────────────────────────────────────────────────────
LOG_LEVEL=INFO
LOG_FORMAT=json
